## 10장 상속과 코드 재사용

객체지향 프로그래밍 장점 중 하나는 코드를 재사용하기가 용이하다는 것이다. 코드를 복사하여 재사용하는 전통적인 방법과 다르게 객체지향은 코드를 재사용하기 위해 '새로운'코드를 추가한다. 객체지향에서 코드는 일반적으로 클래스 안에 작성되기 때문에 객체지향에서 클래스를 재사용하는 방법은 새로운 클래스를 추가하는 것이다.

*만약 모든 코드가 객체지향적이라면 항상 새로운 코드를 추가함으로써 잘 동작하는 소프트웨어를 만들 수 있을 것 같다. 새로운 도메인이 추가되더라도 의존성 전이가 발생하지 않게 이미 잘 끊어놓은 상태의 코드라면 두개의 파일만 컴파일해도 되기에? or 다형성이 구현된 상태라면 한개의 클래스를 추가함으로써 기능의 확장이 가능하다.*

이번 장은 코드의 재사용이 가능한 `상속`과 `합성`중에서 상속을 중점적으로 다룬다. 다루면서 상속의 고질적인 문제점과 상속과 합성의 각각의 장단점을 비교해보자.

*절대로 양분되지 않는 내용이라고 생각한다. 상속이 절대적으로 유리한 부분도 있지만 우리가 흔히 애플리케이션을 개발할 때는 불확실성이 높고 확장성을 생각해야 하기에 합성이 더 유리하다고 하는 것이라 생각한다. 엔진을 예로 엔진은 게임 프레임워크를 어느정도 강제해야 하기 때문에 GameObject와 같이 상속 구조를 가져간다. 하지만 이는 우리가 사용하는 도구에 불과하다. 따라서 해당 구조에 탑승하여 이를 활용하는 것(게임 프레임워크를 활용)과 실제 동적모델을 설계하는 과정이 동일해서는 안된다고 생각한다.*

### 상속과 중복 코드

중복 코드는 사람들의 마음속에 의심과 불신의 씨앗을 뿌린다. 중복 코드를 발견하면 두 코드가 정말 동일한지에 대한 의심이 발생하고 이미 유사한 코드가 있지만 왜 새로운 코드를 만드는지에 대한 의문이 발생한다. 이런 의심과 불신이 협업에서는 큰 취약점으로 자리 잡을 수 있지만 가장 큰 문제점은 바로 변경에 대한 문제이다.

#### DRY원칙

기본적으로 중복 코드는 변경을 방해한다. 이것이 우리가 객체지향을 공부하는 이유이기도 하며 프로그램의 본질이기도 하다. 요구사항은 항상 변화하는데 코드는 변화할 수 없다는 것은 말이 안되기에 코드 역시 변경에 유연해야 한다. *우리가 개발해야 하는 소프트웨어는 그렇다.*

중복코드는 코드를 수정하는데 필요한 노력이 몇배로 증가하게 된다. 중복 코드의 수정은 해당 코드에만 영향을 주는 것이 아니기 때문에 관련된 모든 코드에게도 영향을 준다. 따라서 효과적으로 중복을 제거하기 위한 **DAY원칙(Don't Repeat yourself)**을 따라야한다.

모든 시스템내에서 단일하고, 예매하지 않고, 정말로 믿을 만한 표현 양식을 가져야 한다. 한 번, 단 한번 또는 단일 지점 제어 원칙이라고도 부른다.

#### 중복과 변경

##### 중복 코드 살펴보기

중복 코드의 문제점을 이해하기 위해 간단한 요금을 계산하는 애플리케이션이 있다.

- 10초당 5원의 통화료를 부과하는 요금제에 가입되어 있다
  - 100초의 통화는 50원으로 계산된다.
  - 이를 Call이라는 동적 모델로 만들면 `from`과 `to`라는 두개의 인스턴스 변수를 가진다.
- 통화 요금을 계산할 객체는 전체 통화 목록을 알고 있는 정보 전문가인 `Phone`이다.
  - `Phone`은 `Call`의 목록을 가지고 있으며 `calculateFee`라는 메서드를 가지고 있다. 이를 통해 전체 통화 요금을 계산한다.
  - 계산을 위해 단위 요금인 `amount`와 `seconds`를 인스턴스 변수로 가진다.

```cs
Phone phone = new Phone(Money.wons(5), Duration.seconds(10));
phone.Call(new Call(LocalDateTime.of(2018, 1, 1, 12, 10, 0), LocalDateTime.of(2018, 1, 1, 12, 11, 0)));
phone.Call(new Call(LocalDateTime.of(2018, 1, 1, 12, 13, 0), LocalDateTime.of(2018, 1, 1, 12, 15, 0)));
phone.calculateFee();
```

위 코드는 정상동작하고 도메인에 맞게 설계되었다고 말할 수 있다. 하지만 요구사항은 항상 변한다. 애플리케이션 역시 예외일수는 없고 만약 요구사항으로 심야 할인 요금제가 추가된다면 어떻게 해야할까? 여기선 일단 단점을 봐야하기에 상속 구조를 사용해본다.

*심야 할인이 아니라 심야 할증이 되어야 하는게 아닌가?*

##### 중복 코드 수정하기

중복 코드가 코드 수정에 미치는 영향을 살펴보기 위해 샤로운 요구사항을 추가한다. 지금은 통화 요금을 계산하는 로직은 `Phone`과 `NightlyDiscountPhone` 양쪽 모두에 구현돼있기 때문에 세금을 추가하기 위해서는 두 클래스를 함께 수정해야 한다.

중복 코드를 제거하지 않는 상태에서 코드를 수정할 수 있는 유일한 방법은 새로운 중복 코드를 추가하는 것뿐이다. 새로운 코드를 수정할 수 있는 방법은 새로운 중복 코드를 추가하는 것뿐이다. 새로운 코드를 추가하는 과정에서 코드의 일관성이 무너질 위험이 항상 도사리고 있다. 중복 코드가 늘어날수록 애플리케이션은 변경에 취약하고 버그가 발생할 확률이 높아진다.

민첩하게 변경하기 위해서는 중복 코드를 추가하는 대신 제거해야 한다. 기회가 생길 때마다 코드를 DRY하게 만들어야 한다.

##### 타입 코드 사용하기

