## 4장 오류

> 코드가 실행되는 환경은 불완전하다.

### 논의 사항

실제로 예외를 구현해서 사용하는 경우가 많나요?  

대분의 예외는 만들어져있다고 알고 있었습니다.  

필요에 의해서 만들어진 예외는 어떤 경우가 있는지 궁금합니다.

### 책의 내용 및 정리

핵심 주제  

* 시스템이 복구할 수 있는 오류와 복구할 수 없는 오류의 구분
* 신속하게 실패하고 분명하게 실패함
* 오류를 전달하기 위한 다양한 기법과 선택을 위한 고려 사항  

#### 복구 가능성  

소프트웨어에 대해 생각할 때, 특정 오류가 발생한 경우 복구할 수 있는 오류와 복구할 수 없는 오류가 있다.  

즉, 오류가 발생했을 때 무엇을 할 것인지 결정하기 위해서는 자신의 코드가 어떻게 사용될 것인지 신중하게 생각해야한다.  

* 복구 가능한 오류  

전화번호를 예로 유효하지 않은 입력값이 들어왔을 때 전체시스템 작동을 멈춘다면 문제가 될 수 있다.  

따라서 오류메세지를 제공하고 다시 요청하는 것이 낫다.  

이 내용을 읽고 처음 든 생각은 하나의 함수 자체에서 널값이 들어왔을 때 `nullreferenceexception`이 발생하고 예외처리를 따로 하지 않았다면 시스템자체가 멈추게 된다.  

이러한 예외를 막고자 앞에서 말했던 방어적 프로그래밍으로 일어날 수 있는 예외를 사전에 미리 차단하는 것도 중요하다.  

그렇다면 여기서 또 의문이다. 3장에서 말했던 광범위한 함수 내부에서 예외처리를 하게 된다면 함수를 오용하게 되고 함수 자체의 성격도 옅어지게 된다.  

이러한 문제에서 절충점이 뭘까 생각하니 위에서 말한 함수내부에서 처리하지 않고 외부로 반환값을 줘서 해당 경우에 대한 예외레벨에서 처리하는 것이다.  

이게 맞는 방법인지는 잘모르겠지만.. 지금의 생각은 이렇다..  

* 복구할 수 없는 오류  

오류가 발생하고 시스템이 오류를 복구할 수 있는 합리적인 방법이 없을 때가 있다.  

대부분 프로그래밍 오류때문에 발생한다.  

* 코드와 함께 추가되어야 하는 리소스가 없다.
* 어떤 코드가 다른 코드를 잘못 사용한다.(잘못된 인수, 사전에 초기화 작업x)  

개발자가 이러한 오류를 해결하는 방법인 일찍이 오류를 발견하고 해결하는 것..  

> 신속한 실패  

#### 견고성과 실패  

소프트웨어가 오류가 발생한다면 실패와 견고성중 하나를 선택해야 한다.  

실패의 경우는 더 높은 계층이 오류를 처리하게 하거나 전체 프로그램의 작동을 멈추게 한다.  

오류는 처리하고 계속 진행한다.  

후자의 경우는 실행자체에 문제가 없으니 견고한 코드라고 볼 수 있지만 위험부담을 그 만큼 가지고 갈 수 있다.  

**신속하게 실패하라**  

말 그대로 실패를 두려워 하지 않고 오류를 훌룡하고 안전하게 복구할 수 있는 기회라고 생각하는 것이다.  

이 또한 계층을 나누고 세분화를 통해 모듈화를 하게 되면 테스트에 용이하고 이 처럼 실패를 쉽게 만날 수 있다.  

**요란하게 실패하라**  

오류가 발생하는데도 불구하고 아무도 모르는 상황을 막고자 하는 것이다.  

이를 위한 가장 명백한 방법은 예외를 발생해 프로그램이 중단되게 하는 것   

오류를 서버에 기록하는 방식의 내용이 나왔는데 가끔 프로그램에서 오류가 발생하면 해당 로그를 보내달라는 메세지같이 오류를 수집하는 내용도 흥미로웠다..  

#### 오류를 숨기지 않음  

오류를 숨겨서 프로그램의 동작이 문제가 없어 보여도 오류를 숨기는 것은 복구할 수 있는 오류와 복구할 수 없는 오류 두가지 문제를 모두 일으킨다.  

**기본값 반환**  

오류가 발생하고 함수가 값을 반환할 수 없을 때 기본값을 반환하는 것은 간단하고 쉬운 해결책처럼 보일 수 있다.  

이는 오류를 숨기는데 있어서 호출하는 쪽에서는 모든 것이 정상처럼 작동한다.  

당장 치명적인 오류를 가져올 수 있고 이후에 찾기 힘든 오류로 전락할 수 있다.  

**널 객체 패턴**  

개념적으론 기본값과 유사하지만 이것을 더 확장하여 더 복잡한 객체를 다룬다.  

널 객체는 실제 반환값처럼 보이지만 모든 멤버 함수는 아무것도 하지 않거나 의미 없는 기본값을 반환한다.  

**아무것도 하지 않음**  

코드가 무언가를 반환하지 않고 단지 어떤 작업을 수행하는 경우, 문제가 발생할 때 가능한 한 가지 옵션은 오류가 발생했다는 신호를 보내지 않는 것이다.  

#### 오류 전달 방법  

오류가 발생하면 일반적으로 더 높은 계층에게 알려야 한다.  

오류로부터 복구할 수 없는 경우 일반적으로 훨씬 높은 계층에서 실행을 중지하고 오류를 기록하거나 프로그램의 종료하는 것을 의미한다.  

* 명시적 방법: 코드를 직접 호출한 쪽에서 오류가 발생할 수 있음을 인지할 수 밖에 없도록 한다.  
* 암시적 방법: 코드를 호출하는 쪽에 오류를 알리지만, 호출하는 쪽에서 그 오류를 신경쓰지 않아도 된다.  

#### 예외  

예외라는 개념은 코드에서 오류나 예외적인 상황이 발생한 경우 이를 전달하기 위한 방법으로 고안되었다.  

일반적으로 예외 또한 충분한 기능을 가진 클래스로 구현되며, 요구사항에 맞춰 예외를 정의하고 구현할 수 있다.  

* 명시적 방법: 검사 예외  

컴파일러는 검사 예외에 대해 호출하는 쪽에서 예외를 인지하도록 강제적으로 조치하는데, 호출하는 쪽에서 예외 처리를 위한 코드를 작성하거나 자신의 함수 시그니처에 해당 예외 발생을 선언해야 한다.

*함수 시그니처란? 함수 원형에 명시되는 매개변수 리스트를 가리킨다.*  

* 암시적 방법: 비검사 예외  

비검사 예외를 사용하면 다른 개발자들은 코드가 이 예외를 발생시킬 수 있다는 사실을 전혀 모를 수 있다.  

이 경우에는 함수에서 어떤 예외를 발생시키는지 문서화를 하는 것이 바람직하지만 이 과정조차도 잊어버릴 때가 있다.  

하지만 이러한 문서화 작업은 앞서 다룬 세부조항이기 때문에 신뢰할 방법이 아니다.  

따라서 비검사 예외는 오류가 발생할 수 있다는 것을 호출하는 쪽에서 인지하리라는 보장이 없기 때문에 오류를 암시적으로 알리는 방법이다.  

* 명시적 방법: 널값이 가능한 반환 유형  

함수에서 널값을 반환하는 것은 특정값을 계산하거나 얻는 것이 불가능함을 나타내기 위한 효과적이고 간단한 방법이다.  

*https://learn.microsoft.com/ko-kr/training/modules/csharp-null-safety/*  

주로 사용하는 언어인 C#은 null 안정성에 대한 튜토리얼까지 만들어 두었다..(재밌다)  

현재로는 내가 가장 많이 예외를 처리하는 방법인 것 같다.  

내가 사용하는 처리방법에 대해 정리가 되고 다른 방법들도 소개가 되니 처음에는 읽기 힘들었는데 아는 내용과 상상가능한 내용이 나오니 다시 잘 읽어진다..  

* 명시적 방법: 리절트 반환 유형

널값이나 옵셔널 타입을 반환활 때의 문제 중 하나는 오류 정보를 전달할 수 없다는 것이다.  

호출자에게 값을 얻을 수 없음을 알릴 뿐만 아니라 값을 얻을 수 없는 이유까지 알려주면 유용하다.  

이러한 경우에는 리절트 유형을 사용하는 것이 적절할 수 있다.  

* 명시적 방법: 아웃컴 반환 유형  

어떤 함수들은 값을 반환하기보다는 단지 무언가를 수행하고 값을 변환하지 않는다.  

어떤일을 하는동안 오류가 발생해 그것을 호출한 쪽에 알리고자 한다면 함수가 수행한 동작의 결과를 나타내는 값을 반환하도록 함수를 수정하는 것이 한 가지 방법이 될 수 있다.  

* 암시적 방법: 프로미스 또는 퓨처  

비동기적으로 실행하는 코드를 작성할 때 프로미스나 퓨처를 반환하는 함수를 작성하는 것이 일반적이다.(대부분의 언어는 프로미스나 퓨처는 오류상태도 전달할 수 있다)  

* 암시적 방법: 매직값 반환  

매직값은 함수의 정상적인 반환 유형에 적합하지만 특별한 의미를 부여하는 값이다.  

매직값이 반환될 수 있다는 사실을 알려면 문서나 코드를 읽어야 하기 때문에 암시적인 오류 전달 기법이다.  

#### 복구할 수 없는 오류의 전달  

앞서 말한 복구할 수 없는 오류가 발생한다면 신속하고 그리고 요란하게 실패하는 것이 최상의 방법이다.  

이를 달성하기 위한 몇가지 방법이 있다.  

* 비검사 예외를 발생  
* 프로그램이 패닉이 되도록
* 체크나 어셔선을 사용

이러한 경우 프로그램이 종료되는데, 이는 개발자들이 뭔가 잘못되었음을 알아차린다는 것을 의미한다.  

이러한 즉발적인 오류를 좋은 영향으로 인지하는게 중요하다.  

#### 호출하는 쪽에서 복구하기를 원할 수도 있는 오류의 전달  

이에 대한 방법은 다양하게 존재하며 상당히 주관적임을 설명한다.  

따라서 프로젝트 그리고 팀을 그대로 따라가는게 좋은 방법이다.  

#### 비 검사 예외 VS 명시적 기법  

* 비검사의 예외를 사용해야 한다는 주장

1. 코드 구조 개선: 대부분의 오류 처리 코드의 상위 계층에서 이루어질 수 있기 때문에 비검사 예외를 발생시켜 코드 구조의 개선을 주장
2. 개발자들이 무엇을 할 것인지에 대해서 실용적이어야 함

* 명시적 기법을 사용해야 한다는 주장  

1. 매끄러운 오류 처리: 비검사 예외를 사용한다면 모든 오류를 매끄럽게 처리할 수 있는 단일 계층을 갖기 어렵다.  
2. 실수로 오류를 무사할 수 없다: 어떤 호출자는 실제로 오류를 처리해야 하는 경우가 있을 수 있다.  
3. 개발자들이 무엇을 할 것인지에 대해서 실용적이어야 함(마찬가지로 적용 가능)  

다양한 주장이 있지만 저자는 `명시적 방식을 사용하라`라고 말한다.  

### 느낀점

경험이 부족하다 보니 단편적인 내용이나 상상으로 보는 부분이 있었다..  

나중에 경험을 하고 다시 읽어보면 또 크게 와닿지 않을까?  

읽다보니 오류를 예측하는 능력이 필요해보인다.  
