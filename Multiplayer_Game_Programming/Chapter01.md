## 네트워크 게임의 개요

### 멀티플레이어 게임의 간추린 역사

#### 로컬 멀티플레이어 게임

가장 초창기의 멀티플레이어 게임은 한 대의 PC에 둘 이상의 플레이어가 함께 즐길 수 있도록 고안된 형태이다. *아마 피카츄 배구?* 이는 본격적인 멀티 프로그래밍보단 싱글 플레이 게임과 크게 다르지 않았다.

#### 초기 네트워크 멀티플레이어 게임

1970년대에 이르러 PC, 즉 개인용 PC가 보급되면서 직렬 포트로 컴퓨터를 연결하는 방식이 등장했다. 이를 통해 게임 세션을 구성한 초창기 네트워크 PC 게임이 등장했다.

#### MUD: 멀티 유저 던전

머드라고 불리는 멀티 유저 던전형 게임은 텍스트 기반으로 같은 가상 공간에 여러명이 접속하여 즐기는 형태의 게임이다. PC 성능이 강화되면서 제조사가 모뎀을 제공하기 시작했다. 당시에 이를 활용하면 매우 느리긴 하지만 멀리 떨어진 컴퓨터와 통신이 가능했다.

#### 랜 게임

근거리 통신망(Local Area Network, LAN), LAN은 상대적으로 가까운 지역 내에서 서로 연결된 컴퓨터의 네트워크를 말한다. 앞서 말한 직렬 포트를 직접 연결한 경우도 해당한다. 이후 이더넷이 확산되면서 비로소 전성기를 맞게 된다.

랜 멀티플레이를 선보인 몇몇 게임이 있었지만, `둠`이야 말로 현대 네트워크 게임의 선구자이다. 1993년에 개발된 둠은 최대 4명까지 접속할 수 있었으며 같이 협동 모드를 즐기거나 대결 모드로 즐길 수 있었다.

#### 온라인 게임

대형 통신망을 통해 지리적으로 멀리 떨어진 컴퓨터끼리 연결하여 플레이하는 것을 온라인 게임이라고 한다. 인터넷이 90년대 폭발적으로 보급되면서 온라인 게임도 시대의 요구에 부응하기 시작했다. 이때 등장한 에픽 게임즈의 언리얼이 대표적이다.

온라인 게임과 랜 게임의 구현 원리가 거의 같다 싶기도 하지만 온라인 게임으로 가면서 가장 큰 골칫거리로 떠오른 건 바로 **레이턴시(Latency)**, 즉 네트워크로 데이터를 전송하면서 발생하는 시간 지연이다. (시대가 지나면서 개선되고, 방법들이 많이 나왔다.)

#### MMO 게임

오늘날에도 대다수 멀티플레이어 게임이 접속 인원수를 제한하는데, 그 숫자는 대부분 4인 내지 32인이다. 그에 반해 MMO(Massively Multiplayer Online) 게임은 하나의 게임 세션에 수백 명, 수천, 수만의 플레이어가 동시에 참여할 수 있다. 이것이 대개 MMO가 RPG인 까닭이기도 하다.

#### 모바일 네트워크 게임

모바일 지형으로 게임의 영역이 확장되면서 모바일에도 멀티플레이어 게임이 등잘한다. 모바일 플랫폼에서 멀티플레이어 게임은 대개 비동기식으로 구현된다. 비동기식 멀티플레이 모델에선 데이터를 실시간으로 전송할 필요가 없다.

하지만 오늘날에는 모바일 네트워크 자체가 발전하여 실시간 네트워크를 지원하는 게임들이 속속 등장하고 있다. (하스스톤)

### <스타워즈: 트라이브스>

1998년에 출시된 SF장르의 FPS게임인 스타워즈: 트라이브스는 멀티플레이어 게임의 역사에 큰 발자취를 남겼다. 이 게임은 당시 128명까지 접속이 가능했고 랜이나 인터넷으로 플레이 가능했다. 당시 전화 접속용 모뎀으로 대부분 접속하였고 속도가 56.6kbps였다. 이로 인해 레이턴시가 높아 게임이 끊기거나 렉이 걸리는 경우가 많았다.

이러한 각박한 상황속에서 네트워크 모델을 설계한 게임을 다루는 이유는 현대의 네트워크 모델에서도 상당 부분 적용할 수 있기 때문이다.

네트워크 게임을 설계할 때 가장 먼저 정해둘 것은 **통신 프로토콜**이다. 통신 프로토콜이란, 두 대의 컴퓨터 사이에 어떤 데이터가 오고 갈지를 정해둔 규약이다. 트라이브스는 비신뢰성 **프로토콜인 UDP**를 사용했다. 즉, 네트워크로 보낸 데이터가 수신자에게 반드시 도착한다는 보장이 없다는 뜻이다.

그렇지만 게임에 참여한 **모든 플레이어에게 중요한 정보까지도 모조리 비신뢰성 프로토콜로 보내면 문제가 야기될 수 있다**. 따라서 개발할 때 데이터의 종류에 따라 어떻게 보낼지를 구분해 두어야 한다.

1. **전달 미보장 데이터**: 말 그대로 게임에 있어 그다지 중요하지 않은 데이터를 지칭한다. 대역폭이 고갈되면 게임 시스템은 이런 종류의 데이터부터 생략해 버린다.
2. **전달 보장 데이터**: 수신이 보장되어야 하며 나아가 데이터가 보낸 순서대로 도착하는 것도 보장되어야 하는 데이터이다. 게임에 있어 매우 중요하다고 판단되는 데이터로, **'플레이어가 총을 발사했다.'는 이벤트**가 그 예이다.
3. **최신 상태 데이터**: 최신 상태가 아니면 전달할 의미가 없는 성격의 데이터이다. 예를 들면 **특정 플레이어의 체력 수치**가 그렇다. 지금 현재 HP를 알고 있다면 5초 전의 HP가 얼마였는지는 굳이 전달할 필요가 없다.
4. **특급 전달 보장 데이터**: 최우선으로 보내야 하며 아울러 전달이 보장되어야 하는 데이터가 여기에 속한다. **플레이어 위치 정보**가 그 예로, 시간이 지체될수록 정보의 가치가 급격히 떨어지므로 최대한 빨리 전달해야 한다.

트라이브스가 사용한 네트워킹 모델에선 이들 네 가지 데이터 성격에 따라 여러 세부사항을 결정했다. 또 한 가지 중요한 결정사항은 바로 **피어-투-피어(pear-to-pear, P2P)** 대신 **클라이언트-서버 모델(client-server, 이하 CS 모델)**을 채택한 것이다.

**CS 모델에서는 모든 플레이어가 중앙 서버 하나에 접속하는 데 반해, P2P 모델에선 각각의 플레이어가 모든 플레이어와 연결을 유지해야 한다.** P2P모델은 O(n^2)의 대역폭이 필요하다. 이는 **사용자 수의 제곱**에 비례하여 대역폭이 소모된다는 뜻이다.

트라이브스는 n 즉, 사용자 수가 128명이라면 n의 제곱인 128^2 = 16384의 대역폭이 필요하다. 이 같은 문제를 피하고자 CS 모델을 채택했다. 클라이언트-서버로 구성하면 각 플레이어에 할당되는 대역은 상수로 고정되며 서버에서만 O(n)의 대역폭이 소모된다.

트라이브스의 네트워킹 모델은 스택의 형태를 가지고 있었다.

![image](https://github.com/user-attachments/assets/6c05f9cd-aa8d-4635-99e0-94b453cd08df)

#### 플랫폼 패킷 모듈

**패킷(packet)이란 네트워크로 보내기 위해 데이터를 묶어 놓은 한 단위**를 말한다. 트라이브스 모델의 최하위 계층은 플랫폼 패킷 모듈이다. 이 모듈은 여러 계층 중 유일하게 플랫폼 종속적인 계층이기도 하다. 이 계층은 본질적으로 표준 소켓 API를 래핑 즉, 감싸둔 것에 불과한데, 다양한 패킷 형식으로 조립하고 전송하려는 목적으로 래핑한 것이다.

트라이브스는 비신뢰성 프로토콜을 사용하므로, 전달이 보장되어야 하는 데이터 처리를 위해 몇 가지 메커니즘을 추가할 필요가 있다. 신뢰성 계층을 직접 구현하기로 했으며 이를 상위 계층과 같이 나누어 담당하도록 했다.