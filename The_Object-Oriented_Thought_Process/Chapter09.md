## 9. 객체 구축과 객체지향 설계

전 장에선 상속에 대한 깊이 있는 주제를 다루었다면 이번 장에선 합성에 대한 개별 객체간의 상호작용을 알아본다.

### 9.1. 합성 관계

앞 장들에서 설명했듯이 합성은 전체 중의 한 부분을 나타낸다는 것을 설명했다.

상속은 is-a관계이지만, 합성은 has-a관계이다.

*자동차에 핸들이 포함된다.*

합성을 사용하는 이유는 더 단순한 부품으로 묶어서 시스템으 구축할 수 있기 때문이다.

> 연구에 따르면 기억력 좋은 사람도 단기적으로 한 번에 일곱 개의 일시적인 내용만을 기억할 수 있다.  
> 따라서 우리는 개념을 추상적으로 다루기를 좋아한다.  
> 즉. 운전대와 네 개의 바퀴, 엔진등을 가진 대형 장치보다 자동차라고 말하는 것과 같다.

합성은 또한 부품을 바꿀 때에도 도움이 된다.

모든 운전대가 똑같다면 특정 자동차에 어떤 운전대가 설치되어 있는지는 중요하지 않다.

소프트웨어 개발에서 교체 가능한 부품이 있다는 건 곧 재사용을 의미한다.

### 9.2. 단계적으로 구축하기

합성을 사용할 때의 또 다른 주요 이점은 **시스템과 자식 시스템을 독립적으로 구축할 수 있으며, 더 중요하게 독립적으로 테스트하고 유지보수**를 할 수 있다는 것이다.

사실 소프트웨어 시스템이 상당히 복잡하다는 데는 의문의 여지가 없다.

양질의 소프트웨어를 구축하려면 우선 적용 규칙을 따라야 한다.

**가능한 한 간단하게 유지한다는 규칙이다.**

큰 소프트웨어 시스템이 제대로 작동하게 하고 유지보수를 쉽게 할 수 있으려면 더 작고 관리하기 쉬운 부분으로 나누어야 한다.

이렇게 하면 어떤 장점이 있는지 알아보자.

- "복잡하지만 안정된 시스템은 보통 위계구조라는 형태를 취하는데, 각 시스템은 더 단순한 하부 시스템을 사용해 구축되며, 각 하부 시스템은 여전히 그보다 더 단순한 하부 시스템으로 구축된다."
- "안정적이면서도 복잡한 시스템은 거의 다 분해해 볼 수 있다."
- "복잡하지만 안정된 시스템은 거의 항상 서로 다른 조합으로 배열된 몇 가지 종류의 자식시스템으로만 합성된다."
- "작동 중인 안정 시스템은 거의 항상 작동해 왔던 단순한 시스템에서 발전했다."

만약 합성의 개념을 사용하지 않는다면 자바 및 닷넷 프레임워크는 굉장히 불리해진다.

객체가 동적으로 적재되기 때문에 설계를 분리해야만 한다.

만약 애플리케이션으 배포한 후에 클래스 파일 중 하나를 다시 작성해야 한다면 해당 특정 클래스만 수정할 수 있지만 단일 파일이라면 애플리케이션 자체를 재배포해야 한다.

*컴포넌트 패턴..!*

주요 이점 중 하나는 조직 내의 다른 개발자 또는 타사 공급업체가 작성한 컴포넌트를 사용할 수 있다는 것이다.

### 9.3. 합성 유형

일반적으로 결합(association)과 응집(aggregation)이라는 두 가지 유형의 합성 방식이 있다.

두 방식은 모두 객체 간의 협업 관계를 나타낸다.

합성의 주요 장점 중 결합은 자동차와 핸들의 관계를 나타낸다.

> 합성은 결합의 한 가지 형태일까?  
> 합성은 객체지향 기술의 또 다른 영역 영역으로 닭이나 달걀이냐 대한 문제가 먼저 발생한다.  

모든 형태의 합성에는 has-a 관계가 포함된다.

그러나 전체 부분을 시각화하는 방법에 따라 결합과 응집 간에 미묘한 차이가 있다.

응집에서는 일반적으로 전체만 표시하고 결합에서는 일반적으로 전체를 이루는 부분을 표시한다.

#### 9.3.1. 응집

아마도 가장 직관적인 형태는 응집일 것이다.

응집은 복합 객체가 그 밖의 객체들로 구성되어 있음을 의미한다.

TV를 생각할 때 우리가 보기에 TV는 단일 장치로 되어있다.

대체로 사람들은 TV에 마이크로칩이나 스크린이나 튜너 등이 포함되어 있다는 사실까지 생각하지 않는다.

물론 전원버튼이나 화면 표시장치등은 볼 수 있다.

단순 차를 구매하는 것과 같다.

#### 9.3.2. 결합

응집은 일반적으로 전체만 보는 관계를 나타내는 반면, 결합은 전체와 부분을 모두 나타낸다.

전통적인 데스크탑 컴퓨터 시스템을 본다면 컴퓨터 시스템은 전체를 나타낸다.

모니터, 키보드, 마우스 및 기본 상자는 컴포넌트에 해당한다.

각 컴포넌트가 별도의 객체이지만, 이것들이 모두 모여 컴퓨터 시스템 전체를 나타낸다.

컴퓨터 본체는 마우스, 키보드 및 모니터가 일부 작업을 대신하게 된다.

*결합은 서비스들이 별개로 이뤄지고 있음을 나타낸다.*  

> 결합 대 응집  
> 응집체는 다른 객체들을 가지고 합성할 복합 객체다.  
> 결합체는 한 객체가 그 밖의 객체로부터 서비스를 받기를 원할 때 사용된다.  

#### 9.3.3. 결합체와 응집체를 사용하기

예제를 봐도 사실 무엇이 결합체이고 무엇이 응집체인지 명확하게 구분짓기 힘들다.

흥미로운 설계 결정 중 많은 부분이 결합체를 사용할지 아니면 응집체를 사용할지를 결정하는 일과 관련되어 있다고 할 수 있다.

예를 들어, 결합체를 설명하는 데스크탑 컴퓨터는 일부 응집이라는 개념이 들어 있다.

컴퓨터 본체, 마우스, 키보드 등과 상호작용은 결합으로 나타내지만, 컴퓨터 본체 자체는 응집을 나타낸다.

따라서 **정답은 없다.**

### 9.4. 의존체 회피하기

합성을 사용할 때 객체를 서로 의존하지 않게 하는 편이 바람직하다.

서로 의존하는 객체를 만드는 한 가지 방법은 도메인들을 섞는 것이다.

세상에서 가장 좋은 점은 특성 상황을 제외하고 한 도메인의 객체를 다른 도메인의 객체와 섞어서는 안된다는 점이다.

스테래오 예제를 들어서 설명한다면 모든 컴포넌트를 별도의 도메인에 유지함으로써 음향기기를 더 쉽게 유지할 수 있다.

예를 들어, CD 컴포넌트가 고장 나면 CD 플레이어를 보내 개별적으로 수리할 수 있다.

CD플레이어와 MP3플레이어의 도메인은 서로 다르다.

이 경우 CD 플레이어와 MP3 플레이어를 구매하는 식으로 유연하게 대처할 수 있다.

때로는 도메인을 섞으면 편리할 때도 있다.

몇 년 동안 사용해 온 좋은 구식 TV/VCR 콤비 시스템이 있다.

동일한 모듈에 둘 다 있는 것이 **편리**하다.

하지만 TV가 고장나면 둘다 사용할 수 없게 된다.

이처럼 편리성을 따를 것인지 아니면 안정성을 따를 것인지와 같은, 특정 상황에서 더 중요한 사항을 결정해야 한다.

**정답은 없다. 트레이드 오프만 있을 뿐**  

인터페이스들이 이 문제를 해결하는 데 쓰이며, 의존체들을 관리하는 게 인터페이스가 주로 하는 일이다.

인터페이스가 공유 라이브러리에 정의되어 있고 구현부가 더 구상적인 클래스에 정의되어 있으면 행위 계약을 사용해 도메인을 섞어 볼 여지가 생긴다.

### 9.5. 카디널리티

카디널리티는 결합에 참여하는 객체 수와 참여가 선택적인지 아니면 필수적인지 여부를 설명한다고 했다.

카디널리티를 결정하기 위한 질문은 다음과 같다.

- 어떤 객체가 그 밖의 객체들과 협업하는가?
- 각 협업에 몇 개의 객체가 참여하는가?
- 협업은 선택 사항인가, 아니면 필수인가?

만약 Person에서 상속받고 다음 예에 나오는 클래스들과 관계가 있는 Employee 클래스를 만든다.

- Division
- JobDescription
- Spouse
- Child

이 클래스들이 무엇을 하는가? 이 클래스들을 선택해서 쓸 수 있는가? Employee는 몇 개나 필요한가?

- Division
  - 이 객체에는 직원이 근무하는 부서와 관련된 정보가 포함된다.
  - 각 직원은 부서를 위해 일해야 하므로 관계는 필수다.
  - 직원은 한 개 부서에서만 근무한다.
- JobDescription
  - 이 객체에는 직무에 대한 설명이 포함되어 있으며, 급여 등급 및 급여 범위와 같은 정보가 포함되어 있다.
  - 각 직원은 직무 기술서를 가지고 있어야 하므로 관계는 필수다.
  - 직원은 회사에서 재직하는 동안에 다양한 일을 맡을 수 있다. 따라서 한 직원에게 많은 직무 기술서가 있을 수 있다.
- Spouse
  - 이 간단한 예에서 spouse 클래스에는 기념일만 포함된다.
  - 직원은 결혼했거나 결혼하지 않았을 수 있다. 따라서 배우자는 선택사항이다.
  - 직원은 배우자를 한 명만 가질 수 있다.
- Child
  - 이 간단한 예제에서 Child 클래스에는 FavoriteToy 문자열만 포함된다.
  - 직원에게는 자녀가 있거나 없을 수 있다.
  - 직원에게는 자녀가 없거나 무한한 자녀가 있을 수 있다.

| 선택적/결합 | 카디널리티 | 필수 여부 |
| ----------- | ---------- | --------- |
| Employee/Division | 1 | 필수 |
| Employee/JobDescription | 1..n | 필수 |
| Employee/Spouse | 0..1 | 선택 |
| Employee/Child | 0..n | 선택 |

#### 9.5.1. 선택적 결합체

결합체들을 다룰 때 가장 중요한 문제 중의 하나는 애플리케이션이 선택적 결합체를 확인하도록 설계되었는지 확인하는 것이다.

즉, 코드는 결합체가 null인지를 확인해야 한다.

```java
public String getSpouseName() {
    return Sqousel //매우 위험
}
```

결론은 null을 확인하고 이를 유효한 조건으로 처리해야 한다는 것이다.

### 9.6. 결론

이번 장에선 합성에 대한 좀 더 깊은 부분을 알아보고 두 가지 주요 형식인 응집과 결합에 대해서도 살펴봤다.

상속이라는 관계로는 새 객체가 기존 객체의 새로운 종류임을 나타내는 반면, 합성이라는 관계로는 객체 간의 상호작용(협업)을 나타낸다.
